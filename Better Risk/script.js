var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");

var mouse = {x:null, y:null, down:null, prev:null};
document.onmousemove = function(event) {
	mouse.x = event.offsetX;
	mouse.y = event.offsetY;
}
canvas.onmousedown = function(event) {
	if (event.which === 1) {
		mouse.down = true;
	}
}
canvas.onmouseup = function(event) {
	if (event.which === 1) {
		mouse.down = false;
	}
}
document.oncontextmenu = function(event) {
	event.preventDefault();
}
var keysDown = [];
document.onkeydown = function(event) {
	if (event.ctrlKey && event.which === 83) {
		event.preventDefault();
		save();
	} else if (event.ctrlKey && event.which === 90) {
		if (stage === 0) {
			event.preventDefault();
			polygon.pop();
		}
	} else if (event.ctrlKey && event.which === 70) {
		if (stage === 0) {
			event.preventDefault();
			polygon.push({x: continents[critPointer[0]].polygon[critPointer[1]+1].x, y: continents[critPointer[0]].polygon[critPointer[1]+1].y});
			critPointer[1]++;
		}
	} else if (event.ctrlKey && event.which === 71) {
		if (stage === 0) {
			event.preventDefault();
			polygon.push({x: continents[critPointer[0]].polygon[critPointer[1]-1].x, y: continents[critPointer[0]].polygon[critPointer[1]-1].y});
			critPointer[1]--;
		}
	} else {
		if (!keysDown.includes(event.key)) {
			keysDown.push(event.key);
		}
	}
}
document.onkeyup = function(event) {
	keysDown.splice(keysDown.indexOf(event.key));
}

class Button {
	constructor(label, x, y) {
		this.label = label;
		if (x === undefined) {
			this.x = 0;
		} else {
			this.x = x;
		}
		if (y === undefined) {
			this.y = 0;
		} else {
			this.y = y;
		}
		ctx.font = "24px Arial";
		this.width = ctx.measureText(label).width+20;
		this.height = 30+10;
		this.textOffX = 10;
		this.textOffY = 5;
		
		this.hover = false;
		this.action = function(){};
	}
	mouseOn() {
		if (this.x <= mouse.x && mouse.x < this.x+this.width && this.y <= mouse.y && mouse.y < this.y+this.height) {
			return (true);
		} else {
			return (false);
		}
	}
	update() {
		if (this.mouseOn()) {
			this.hover = true;
			document.body.style.cursor = "pointer";
			if (mouse.down && !mouse.prev) {
				this.action();
				return (true);
			}
		} else {
			this.hover = false;
		}
		return (false);
	}
	render() {
		if (this.hover) {
			ctx.fillStyle = "#6df";
		} else {
			ctx.fillStyle = "#4bf";
		}
		ctx.fillRect(this.x, this.y, this.width, this.height);
		ctx.fillStyle = "#fff";
		ctx.font = "24px Arial";
		ctx.fillText(this.label, this.textOffX+this.x, this.textOffY+this.y+24);
	}
}
class Dropdown {
	constructor(x, y) {
		if (x === undefined) {
			this.x = 0;
		} else {
			this.x = x;
		}
		if (y === undefined) {
			this.y = 0;
		} else {
			this.y = y;
		}
		this.width = 250;
		this.height = 300;
		this.textOffX = 10;
		this.textOffY = 5;
		this.visible = true;
		
		this.hover = null;
		this.items = [];
	}
	mouseOn() {
		if (this.x <= mouse.x && mouse.x < this.x+this.width && this.y <= mouse.y && mouse.y < this.y+this.height) {
			return (true);
		} else {
			return (false);
		}
	}
	update() {
		this.hover = null;
		if (this.visible) {
			if (this.mouseOn()) {
				this.hover = (mouse.y-this.y-this.textOffY)/24;
				if (this.hover < 0) {
					this.hover = null;
				} else if (this.hover >= this.items.length) {
					this.hover = null;
				} else {
					this.hover = Math.floor(this.hover);
					if (mouse.down && !mouse.prev) {
						this.action(this.hover);
					}
				}
				if (mouse.down) {
					return (true);
				}
			}
		}
		return (false);
	}
	render() {
		if (this.visible) {
			ctx.fillStyle = "#222";
			ctx.fillRect(this.x, this.y, this.width, this.height);
			if (this.hover !== null) {
				ctx.fillStyle = "#777";
				ctx.fillRect(this.x, this.textOffY+this.y+24*(this.hover), this.width, 24);
			}
			ctx.fillStyle = "#fff";
			ctx.font = "24px Arial";
			for (var i = 0; i < this.items.length; i++) {
				ctx.fillText(this.items[i], this.textOffX+this.x, this.textOffY+this.y+24*(i+1)-4);
			}
		}
	}
}

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.onresize = function () {
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
}

function distance(x1, y1, x2, y2) {
	return(Math.sqrt((x2-x1)*(x2-x1) + (y2-y1)*(y2-y1)));
}

var reference = {};
reference.ref1 = new Image();
reference.ref1.src = "reference.png";

var stage = 4;
var stages = new Dropdown();
stages.items.push("Create Continents");
stages.items.push("Create Connections");
stages.items.push("Edit Countries");
stages.items.push("Create Bonus Groups");
stages.items.push("Preview");
stages.visible = false;
stages.action = function(menuItem) {
	this.visible = false;
	stage = menuItem;
}
var next = new Button("Next");
next.action = function() {
	stages.visible = true;
}

var addRegion = new Button("Add New");
addRegion.action = function() {
	createBonusGroup(prompt("Name"), Number(prompt("Value", 0)), prompt("Colour"));
}

var groupSelected = 0;
var bonusValues = [];
var bonusGroups = new Dropdown();
function createBonusGroup(name, value, colour) {
	bonusGroups.items.push(name);
	bonusValues.push({name: name, value: value, colour: colour});
}

createBonusGroup("Region 0", 0, "#509");
createBonusGroup("Bymar", 2, "#4bf");
createBonusGroup("West Gelyn", 3, "#191");
createBonusGroup("East Gelyn", 3, "#4d2");
createBonusGroup("North Avenia", 4, "#e20");
createBonusGroup("South Avenia", 6, "#333");
createBonusGroup("NW Carthya", 3, "#129");
createBonusGroup("NE Carthya", 2, "#25b");
createBonusGroup("Drylliad", 5, "#fe0");
createBonusGroup("South Carthya", 3, "#37e");
createBonusGroup("North Mendenwal", 5, "#eee");
createBonusGroup("Central Mendenwal", 7, "#ff5");
createBonusGroup("South Mendenwal", 5, "#ff0");

bonusGroups.action = function(menuItem) {
	groupSelected = menuItem //bonusGroups.items[menuItem];
}

var continents = [];
function save() {
	localStorage.continents = JSON.stringify(continents);
	localStorage.bonusGroupsItems = JSON.stringify(bonusGroups.items);
	localStorage.bonusValues = JSON.stringify(bonusValues);
}
function load() {
	if (localStorage.continents === undefined) {
		localStorage.continents = `[{"name":"Bymar","center":{"x":141.6875,"y":52.125},"polygon":[{"x":90,"y":0},{"x":76,"y":15},{"x":69,"y":39},{"x":76,"y":68},{"x":100,"y":86},{"x":105,"y":85},{"x":122,"y":90},{"x":144,"y":86},{"x":164,"y":88},{"x":166,"y":71},{"x":171,"y":61},{"x":180,"y":55},{"x":199,"y":44},{"x":205,"y":32},{"x":203,"y":14},{"x":197,"y":0}],"connections":[1,2,3],"region":1},{"name":"Ropi","center":{"x":74.625,"y":89.75},"polygon":[{"x":76,"y":68},{"x":100,"y":86},{"x":90,"y":90},{"x":85,"y":108},{"x":66,"y":102},{"x":60,"y":102},{"x":57,"y":88},{"x":63,"y":74}],"connections":[0,2],"region":1},{"name":"Odella","center":{"x":132.93333333333334,"y":105.13333333333334},"polygon":[{"x":85,"y":108},{"x":90,"y":90},{"x":100,"y":86},{"x":105,"y":85},{"x":122,"y":90},{"x":144,"y":86},{"x":164,"y":88},{"x":178,"y":93},{"x":177,"y":111},{"x":166,"y":122},{"x":165,"y":128},{"x":146,"y":127},{"x":132,"y":123},{"x":118,"y":120},{"x":102,"y":120}],"connections":[0,1,3,4,33],"region":1},{"name":"Bodaybo","center":{"x":198.69230769230768,"y":49.76923076923077},"polygon":[{"x":197,"y":0},{"x":234,"y":0},{"x":235,"y":38},{"x":225,"y":70},{"x":211,"y":67},{"x":195,"y":69},{"x":178,"y":93},{"x":164,"y":88},{"x":166,"y":71},{"x":171,"y":61},{"x":199,"y":44},{"x":205,"y":32},{"x":203,"y":14}],"connections":[2,0,4,6,5],"region":1},{"name":"Lyneth","center":{"x":200.76470588235293,"y":109.29411764705883},"polygon":[{"x":165,"y":128},{"x":166,"y":122},{"x":177,"y":111},{"x":178,"y":93},{"x":195,"y":69},{"x":211,"y":67},{"x":225,"y":70},{"x":225,"y":89},{"x":233,"y":100},{"x":241,"y":129},{"x":233,"y":131},{"x":217,"y":124},{"x":201,"y":126},{"x":195,"y":121},{"x":191,"y":126},{"x":184,"y":123},{"x":176,"y":129}],"connections":[3,6,2],"region":1},{"name":"Ruby Dome","center":{"x":288.56666666666666,"y":59.233333333333334},"polygon":[{"x":234,"y":0},{"x":235,"y":38},{"x":230,"y":56},{"x":239,"y":64},{"x":251,"y":75},{"x":260,"y":80},{"x":263,"y":88},{"x":265,"y":97},{"x":263,"y":104},{"x":269,"y":103},{"x":281,"y":107},{"x":286,"y":105},{"x":296,"y":95},{"x":302,"y":92},{"x":304,"y":94},{"x":311,"y":88},{"x":312,"y":76},{"x":309,"y":73},{"x":312,"y":64},{"x":310,"y":63},{"x":324,"y":47},{"x":324,"y":41},{"x":317,"y":33},{"x":309,"y":25},{"x":308,"y":21},{"x":310,"y":20},{"x":310,"y":13},{"x":309,"y":11},{"x":309,"y":4},{"x":305,"y":0}],"connections":[3,8,7,6],"region":2},{"name":"Tanna","center":{"x":252.77272727272728,"y":113.31818181818181},"polygon":[{"x":230,"y":56},{"x":225,"y":70},{"x":225,"y":89},{"x":233,"y":100},{"x":241,"y":129},{"x":245,"y":133},{"x":253,"y":149},{"x":253,"y":156},{"x":256,"y":159},{"x":260,"y":166},{"x":260,"y":148},{"x":270,"y":141},{"x":271,"y":130},{"x":267,"y":125},{"x":268,"y":121},{"x":263,"y":113},{"x":263,"y":104},{"x":265,"y":97},{"x":263,"y":88},{"x":260,"y":80},{"x":251,"y":75},{"x":239,"y":64}],"connections":[4,3,8,9,5],"region":2},{"name":"Ninnis","center":{"x":343.53333333333336,"y":58},"polygon":[{"x":305,"y":0},{"x":309,"y":4},{"x":309,"y":11},{"x":310,"y":13},{"x":310,"y":20},{"x":308,"y":21},{"x":309,"y":25},{"x":317,"y":33},{"x":324,"y":41},{"x":324,"y":47},{"x":310,"y":63},{"x":312,"y":64},{"x":318,"y":64},{"x":325,"y":69},{"x":326,"y":74},{"x":330,"y":79},{"x":346,"y":87},{"x":352,"y":97},{"x":350,"y":106},{"x":355,"y":107},{"x":362,"y":102},{"x":371,"y":96},{"x":383,"y":95},{"x":389,"y":101},{"x":399,"y":95},{"x":406,"y":84},{"x":407,"y":76},{"x":404,"y":62},{"x":368,"y":4},{"x":368,"y":0}],"connections":[8,5,11,13,10],"region":2},{"name":"Grymshuck","center":{"x":312.0882352941176,"y":114.3529411764706},"polygon":[{"x":263,"y":104},{"x":269,"y":103},{"x":281,"y":107},{"x":286,"y":105},{"x":296,"y":95},{"x":302,"y":92},{"x":304,"y":94},{"x":311,"y":88},{"x":312,"y":76},{"x":309,"y":73},{"x":312,"y":64},{"x":318,"y":64},{"x":325,"y":69},{"x":326,"y":74},{"x":330,"y":79},{"x":346,"y":87},{"x":352,"y":97},{"x":350,"y":106},{"x":353,"y":132},{"x":361,"y":141},{"x":362,"y":149},{"x":355,"y":161},{"x":355,"y":177},{"x":348,"y":174},{"x":338,"y":162},{"x":321,"y":155},{"x":313,"y":149},{"x":293,"y":145},{"x":281,"y":136},{"x":270,"y":141},{"x":271,"y":130},{"x":267,"y":125},{"x":268,"y":121},{"x":263,"y":113}],"connections":[5,6,9,7,10],"region":2},{"name":"Jackson Head","center":{"x":307.8888888888889,"y":167.88888888888889},"polygon":[{"x":260,"y":166},{"x":260,"y":148},{"x":270,"y":141},{"x":281,"y":136},{"x":293,"y":145},{"x":313,"y":149},{"x":321,"y":155},{"x":338,"y":162},{"x":348,"y":174},{"x":355,"y":177},{"x":362,"y":183},{"x":350,"y":190},{"x":348,"y":188},{"x":314,"y":190},{"x":298,"y":183},{"x":289,"y":180},{"x":275,"y":179},{"x":267,"y":176}],"connections":[6,8,10,29,33],"region":2},{"name":"Kellinton","center":{"x":377.65,"y":133.15},"polygon":[{"x":350,"y":106},{"x":355,"y":107},{"x":362,"y":102},{"x":371,"y":96},{"x":383,"y":95},{"x":389,"y":101},{"x":392,"y":110},{"x":401,"y":111},{"x":417,"y":117},{"x":428,"y":124},{"x":414,"y":146},{"x":394,"y":159},{"x":377,"y":168},{"x":372,"y":178},{"x":362,"y":183},{"x":355,"y":177},{"x":355,"y":161},{"x":362,"y":149},{"x":361,"y":141},{"x":353,"y":132}],"connections":[7,8,9,13,18,19,29],"region":2},{"name":"Borsten","center":{"x":484.5,"y":44.388888888888886},"polygon":[{"x":368,"y":0},{"x":368,"y":4},{"x":400,"y":56},{"x":405,"y":55},{"x":415,"y":53},{"x":453,"y":53},{"x":495,"y":78},{"x":500,"y":66},{"x":506,"y":62},{"x":516,"y":64},{"x":523,"y":68},{"x":531,"y":66},{"x":540,"y":61},{"x":539,"y":44},{"x":545,"y":32},{"x":542,"y":23},{"x":545,"y":14},{"x":530,"y":0}],"connections":[7,12,14,13],"region":3},{"name":"Dinari","center":{"x":581.44,"y":44.96},"polygon":[{"x":530,"y":0},{"x":545,"y":14},{"x":542,"y":23},{"x":545,"y":32},{"x":539,"y":44},{"x":540,"y":61},{"x":531,"y":66},{"x":523,"y":68},{"x":537,"y":68},{"x":546,"y":64},{"x":555,"y":61},{"x":567,"y":62},{"x":574,"y":66},{"x":575,"y":71},{"x":580,"y":78},{"x":597,"y":68},{"x":604,"y":56},{"x":604,"y":53},{"x":617,"y":42},{"x":622,"y":40},{"x":638,"y":31},{"x":641,"y":26},{"x":661,"y":17},{"x":659,"y":13},{"x":664,"y":0}],"connections":[11,14,15],"region":3},{"name":"Tickabinga","center":{"x":451.96666666666664,"y":101.56666666666666},"polygon":[{"x":400,"y":56},{"x":405,"y":55},{"x":415,"y":53},{"x":453,"y":53},{"x":495,"y":78},{"x":494,"y":93},{"x":495,"y":106},{"x":503,"y":115},{"x":518,"y":115},{"x":545,"y":124},{"x":543,"y":139},{"x":535,"y":133},{"x":510,"y":149},{"x":484,"y":127},{"x":469,"y":108},{"x":459,"y":108},{"x":447,"y":105},{"x":440,"y":104},{"x":436,"y":109},{"x":437,"y":115},{"x":433,"y":122},{"x":428,"y":124},{"x":417,"y":117},{"x":401,"y":111},{"x":392,"y":110},{"x":389,"y":101},{"x":399,"y":95},{"x":406,"y":84},{"x":407,"y":76},{"x":404,"y":62}],"connections":[11,7,10,14,16,53,24,17,18],"region":3},{"name":"Munsk","center":{"x":539.2857142857143,"y":86.76190476190476},"polygon":[{"x":545,"y":124},{"x":518,"y":115},{"x":503,"y":115},{"x":495,"y":106},{"x":494,"y":93},{"x":495,"y":78},{"x":500,"y":66},{"x":506,"y":62},{"x":516,"y":64},{"x":523,"y":68},{"x":537,"y":68},{"x":546,"y":64},{"x":555,"y":61},{"x":567,"y":62},{"x":574,"y":66},{"x":575,"y":71},{"x":580,"y":78},{"x":586,"y":95},{"x":575,"y":112},{"x":570,"y":124},{"x":565,"y":130}],"connections":[11,13,12,15,16],"region":3},{"name":"Stockport","center":{"x":624.9130434782609,"y":69.6086956521739},"polygon":[{"x":580,"y":78},{"x":597,"y":68},{"x":604,"y":56},{"x":604,"y":53},{"x":617,"y":42},{"x":622,"y":40},{"x":638,"y":31},{"x":641,"y":26},{"x":661,"y":17},{"x":654,"y":33},{"x":640,"y":53},{"x":642,"y":64},{"x":648,"y":70},{"x":656,"y":74},{"x":657,"y":79},{"x":652,"y":86},{"x":644,"y":89},{"x":634,"y":99},{"x":622,"y":108},{"x":608,"y":114},{"x":591,"y":114},{"x":575,"y":112},{"x":586,"y":95}],"connections":[14,12,16],"region":3},{"name":"Erzin","center":{"x":607.88,"y":121.04},"polygon":[{"x":543,"y":139},{"x":545,"y":124},{"x":565,"y":130},{"x":570,"y":124},{"x":575,"y":112},{"x":591,"y":114},{"x":608,"y":114},{"x":622,"y":108},{"x":634,"y":99},{"x":644,"y":89},{"x":652,"y":86},{"x":652,"y":91},{"x":646,"y":93},{"x":644,"y":96},{"x":639,"y":102},{"x":633,"y":108},{"x":631,"y":118},{"x":618,"y":136},{"x":622,"y":143},{"x":620,"y":149},{"x":613,"y":155},{"x":604,"y":156},{"x":590,"y":150},{"x":581,"y":144},{"x":555,"y":146}],"connections":[14,15,13,53],"region":3},{"name":"Mount Awful","center":{"x":455.2564102564103,"y":146.56410256410257},"polygon":[{"x":433,"y":122},{"x":437,"y":115},{"x":436,"y":109},{"x":440,"y":104},{"x":447,"y":105},{"x":459,"y":108},{"x":469,"y":108},{"x":484,"y":127},{"x":480,"y":129},{"x":476,"y":129},{"x":474,"y":132},{"x":470,"y":134},{"x":469,"y":137},{"x":473,"y":142},{"x":466,"y":147},{"x":462,"y":154},{"x":464,"y":161},{"x":469,"y":166},{"x":469,"y":171},{"x":475,"y":177},{"x":475,"y":180},{"x":467,"y":179},{"x":462,"y":182},{"x":457,"y":180},{"x":452,"y":182},{"x":438,"y":178},{"x":438,"y":170},{"x":435,"y":158},{"x":436,"y":157},{"x":440,"y":159},{"x":441,"y":155},{"x":445,"y":156},{"x":446,"y":153},{"x":448,"y":153},{"x":453,"y":147},{"x":447,"y":143},{"x":445,"y":138},{"x":442,"y":137},{"x":436,"y":132}],"connections":[13,18,24,20],"region":6},{"name":"Carchar","center":{"x":428.18518518518516,"y":164.22222222222223},"polygon":[{"x":433,"y":122},{"x":428,"y":124},{"x":414,"y":146},{"x":394,"y":159},{"x":395,"y":163},{"x":395,"y":178},{"x":399,"y":186},{"x":406,"y":206},{"x":414,"y":214},{"x":416,"y":209},{"x":423,"y":203},{"x":423,"y":197},{"x":431,"y":191},{"x":438,"y":178},{"x":438,"y":170},{"x":435,"y":158},{"x":436,"y":157},{"x":440,"y":159},{"x":441,"y":155},{"x":445,"y":156},{"x":446,"y":153},{"x":448,"y":153},{"x":453,"y":147},{"x":447,"y":143},{"x":445,"y":138},{"x":442,"y":137},{"x":436,"y":132}],"connections":[13,10,17,19,20],"region":6},{"name":"Unnamed","center":{"x":391.6666666666667,"y":210.95238095238096},"polygon":[{"x":372,"y":178},{"x":377,"y":168},{"x":394,"y":159},{"x":395,"y":178},{"x":399,"y":186},{"x":406,"y":206},{"x":414,"y":214},{"x":412,"y":218},{"x":409,"y":222},{"x":406,"y":224},{"x":406,"y":226},{"x":399,"y":232},{"x":397,"y":231},{"x":394,"y":234},{"x":394,"y":237},{"x":388,"y":249},{"x":372,"y":258},{"x":376,"y":219},{"x":375,"y":213},{"x":373,"y":197},{"x":367,"y":181}],"connections":[18,10,29,20],"region":6},{"name":"Ashvale","center":{"x":433.72,"y":225.56},"polygon":[{"x":372,"y":258},{"x":388,"y":249},{"x":394,"y":237},{"x":394,"y":234},{"x":397,"y":231},{"x":399,"y":232},{"x":406,"y":226},{"x":406,"y":224},{"x":409,"y":222},{"x":412,"y":218},{"x":414,"y":214},{"x":416,"y":209},{"x":423,"y":203},{"x":423,"y":197},{"x":431,"y":191},{"x":438,"y":178},{"x":452,"y":182},{"x":457,"y":180},{"x":462,"y":182},{"x":467,"y":179},{"x":475,"y":180},{"x":475,"y":185},{"x":477,"y":189},{"x":476,"y":198},{"x":474,"y":202},{"x":471,"y":206},{"x":464,"y":211},{"x":461,"y":213},{"x":462,"y":215},{"x":457,"y":219},{"x":453,"y":220},{"x":453,"y":223},{"x":451,"y":227},{"x":452,"y":235},{"x":454,"y":237},{"x":452,"y":239},{"x":454,"y":243},{"x":452,"y":245},{"x":453,"y":258},{"x":447,"y":258},{"x":441,"y":255},{"x":436,"y":257},{"x":432,"y":261},{"x":428,"y":260},{"x":423,"y":266},{"x":402,"y":263},{"x":395,"y":265},{"x":390,"y":266},{"x":386,"y":269},{"x":380,"y":267}],"connections":[24,25,17,18,19,26,23,22,21],"region":6},{"name":"Rowbury","center":{"x":351.8666666666667,"y":326.8333333333333},"polygon":[{"x":372,"y":258},{"x":358,"y":284},{"x":349,"y":289},{"x":336,"y":303},{"x":336,"y":307},{"x":334,"y":310},{"x":334,"y":314},{"x":331,"y":321},{"x":326,"y":335},{"x":327,"y":342},{"x":324,"y":347},{"x":320,"y":364},{"x":320,"y":371},{"x":328,"y":370},{"x":335,"y":372},{"x":340,"y":370},{"x":350,"y":373},{"x":355,"y":372},{"x":360,"y":368},{"x":360,"y":361},{"x":358,"y":349},{"x":367,"y":341},{"x":373,"y":341},{"x":379,"y":338},{"x":378,"y":312},{"x":377,"y":298},{"x":382,"y":281},{"x":381,"y":278},{"x":386,"y":269},{"x":380,"y":267}],"connections":[22,30,32,37,48,20],"region":6},{"name":"Libeth","center":{"x":404.9259259259259,"y":302.3703703703704},"polygon":[{"x":379,"y":338},{"x":378,"y":312},{"x":377,"y":298},{"x":382,"y":281},{"x":381,"y":278},{"x":386,"y":269},{"x":390,"y":266},{"x":395,"y":265},{"x":402,"y":263},{"x":423,"y":266},{"x":428,"y":269},{"x":431,"y":274},{"x":431,"y":284},{"x":428,"y":288},{"x":427,"y":295},{"x":421,"y":299},{"x":419,"y":306},{"x":420,"y":311},{"x":420,"y":326},{"x":415,"y":326},{"x":412,"y":330},{"x":405,"y":330},{"x":404,"y":334},{"x":399,"y":338},{"x":398,"y":339},{"x":394,"y":341},{"x":388,"y":338}],"connections":[28,23,20,21],"region":6},{"name":"Farthenwood","center":{"x":443.44444444444446,"y":292.27777777777777},"polygon":[{"x":420,"y":326},{"x":420,"y":311},{"x":419,"y":306},{"x":421,"y":299},{"x":427,"y":295},{"x":428,"y":288},{"x":431,"y":284},{"x":431,"y":274},{"x":428,"y":269},{"x":423,"y":266},{"x":428,"y":260},{"x":432,"y":261},{"x":436,"y":257},{"x":441,"y":255},{"x":447,"y":258},{"x":453,"y":258},{"x":455,"y":262},{"x":458,"y":266},{"x":462,"y":269},{"x":461,"y":271},{"x":467,"y":275},{"x":471,"y":282},{"x":469,"y":286},{"x":468,"y":293},{"x":465,"y":300},{"x":464,"y":305},{"x":461,"y":308},{"x":460,"y":314},{"x":455,"y":322},{"x":452,"y":327},{"x":449,"y":329},{"x":443,"y":330},{"x":435,"y":328},{"x":431,"y":331},{"x":429,"y":328},{"x":424,"y":329}],"connections":[28,27,26,20,22],"region":6},{"name":"Sunchester","center":{"x":490.41379310344826,"y":162.48275862068965},"polygon":[{"x":474,"y":202},{"x":476,"y":198},{"x":477,"y":189},{"x":475,"y":185},{"x":475,"y":180},{"x":475,"y":177},{"x":469,"y":171},{"x":469,"y":166},{"x":464,"y":161},{"x":462,"y":154},{"x":466,"y":147},{"x":473,"y":142},{"x":469,"y":137},{"x":470,"y":134},{"x":474,"y":132},{"x":476,"y":129},{"x":480,"y":129},{"x":484,"y":127},{"x":510,"y":149},{"x":535,"y":133},{"x":525,"y":146},{"x":526,"y":149},{"x":524,"y":156},{"x":526,"y":170},{"x":530,"y":174},{"x":532,"y":183},{"x":517,"y":192},{"x":502,"y":198},{"x":487,"y":202}],"connections":[13,17,53,25,20],"region":7},{"name":"Gelvins","center":{"x":497.65384615384613,"y":211.57692307692307},"polygon":[{"x":451,"y":227},{"x":453,"y":223},{"x":453,"y":220},{"x":457,"y":219},{"x":462,"y":215},{"x":461,"y":213},{"x":464,"y":211},{"x":471,"y":206},{"x":474,"y":202},{"x":487,"y":202},{"x":502,"y":198},{"x":517,"y":192},{"x":532,"y":183},{"x":534,"y":186},{"x":532,"y":192},{"x":531,"y":195},{"x":528,"y":202},{"x":530,"y":206},{"x":527,"y":212},{"x":527,"y":219},{"x":524,"y":225},{"x":526,"y":230},{"x":525,"y":234},{"x":511,"y":229},{"x":485,"y":229},{"x":475,"y":231}],"connections":[24,20,26,54,53],"region":7},{"name":"Cut Bank","center":{"x":487.46875,"y":261.90625},"polygon":[{"x":468,"y":293},{"x":469,"y":286},{"x":471,"y":282},{"x":467,"y":275},{"x":461,"y":271},{"x":462,"y":269},{"x":458,"y":266},{"x":455,"y":262},{"x":453,"y":258},{"x":452,"y":245},{"x":454,"y":243},{"x":452,"y":239},{"x":454,"y":237},{"x":452,"y":235},{"x":451,"y":227},{"x":475,"y":231},{"x":485,"y":229},{"x":511,"y":229},{"x":525,"y":234},{"x":525,"y":240},{"x":525,"y":246},{"x":523,"y":252},{"x":522,"y":262},{"x":524,"y":268},{"x":524,"y":277},{"x":521,"y":280},{"x":521,"y":284},{"x":524,"y":286},{"x":522,"y":300},{"x":517,"y":297},{"x":499,"y":289},{"x":477,"y":289}],"connections":[25,20,54,27,55,23],"region":7},{"name":"Tithio","center":{"x":494.1666666666667,"y":309.27777777777777},"polygon":[{"x":455,"y":322},{"x":460,"y":314},{"x":461,"y":308},{"x":464,"y":305},{"x":465,"y":300},{"x":468,"y":293},{"x":477,"y":289},{"x":499,"y":289},{"x":517,"y":297},{"x":522,"y":300},{"x":524,"y":303},{"x":522,"y":312},{"x":523,"y":315},{"x":520,"y":323},{"x":522,"y":327},{"x":515,"y":325},{"x":500,"y":326},{"x":481,"y":319}],"connections":[28,23,26,55],"region":7},{"name":"Drylliad","center":{"x":453.44444444444446,"y":344.75555555555553},"polygon":[{"x":399,"y":338},{"x":404,"y":334},{"x":405,"y":330},{"x":412,"y":330},{"x":415,"y":326},{"x":420,"y":326},{"x":424,"y":329},{"x":429,"y":328},{"x":431,"y":331},{"x":435,"y":328},{"x":443,"y":330},{"x":449,"y":329},{"x":452,"y":327},{"x":455,"y":322},{"x":481,"y":319},{"x":500,"y":326},{"x":515,"y":325},{"x":522,"y":327},{"x":525,"y":333},{"x":524,"y":343},{"x":523,"y":349},{"x":525,"y":355},{"x":526,"y":362},{"x":523,"y":367},{"x":525,"y":373},{"x":520,"y":376},{"x":514,"y":377},{"x":493,"y":367},{"x":483,"y":366},{"x":466,"y":369},{"x":458,"y":373},{"x":443,"y":373},{"x":418,"y":374},{"x":403,"y":366},{"x":410,"y":358},{"x":419,"y":353},{"x":422,"y":349},{"x":423,"y":344},{"x":421,"y":340},{"x":417,"y":339},{"x":410,"y":340},{"x":410,"y":342},{"x":408,"y":342},{"x":407,"y":340},{"x":398,"y":339}],"connections":[66,52,27,23,22,48,50,55],"region":8},{"name":"Issl","center":{"x":355.8,"y":198.9},"polygon":[{"x":350,"y":190},{"x":362,"y":183},{"x":367,"y":181},{"x":373,"y":197},{"x":375,"y":213},{"x":365,"y":208},{"x":354,"y":211},{"x":339,"y":211},{"x":331,"y":203},{"x":342,"y":192}],"connections":[10,9,30,19],"region":4},{"name":"Dichell","center":{"x":329.48148148148147,"y":236.85185185185185},"polygon":[{"x":331,"y":203},{"x":339,"y":211},{"x":354,"y":211},{"x":365,"y":208},{"x":375,"y":213},{"x":376,"y":219},{"x":372,"y":258},{"x":358,"y":284},{"x":349,"y":289},{"x":342,"y":282},{"x":340,"y":272},{"x":334,"y":265},{"x":324,"y":255},{"x":321,"y":253},{"x":316,"y":247},{"x":316,"y":245},{"x":311,"y":240},{"x":305,"y":237},{"x":302,"y":237},{"x":295,"y":230},{"x":299,"y":230},{"x":302,"y":227},{"x":305,"y":226},{"x":311,"y":221},{"x":311,"y":218},{"x":318,"y":210},{"x":325,"y":204}],"connections":[21,31,29,32],"region":4},{"name":"Theives Camp","center":{"x":284.5483870967742,"y":256.0967741935484},"polygon":[{"x":295,"y":230},{"x":302,"y":237},{"x":305,"y":237},{"x":311,"y":240},{"x":316,"y":245},{"x":316,"y":247},{"x":321,"y":253},{"x":322,"y":257},{"x":318,"y":266},{"x":318,"y":270},{"x":311,"y":280},{"x":306,"y":283},{"x":304,"y":282},{"x":299,"y":286},{"x":287,"y":284},{"x":270,"y":277},{"x":258,"y":270},{"x":250,"y":266},{"x":240,"y":254},{"x":242,"y":252},{"x":242,"y":250},{"x":250,"y":247},{"x":258,"y":250},{"x":262,"y":251},{"x":267,"y":250},{"x":267,"y":247},{"x":269,"y":247},{"x":271,"y":248},{"x":277,"y":248},{"x":282,"y":245},{"x":285,"y":240}],"connections":[30,32,33],"region":4},{"name":"Devil's Hook","center":{"x":301.4054054054054,"y":292.43243243243245},"polygon":[{"x":270,"y":277},{"x":287,"y":284},{"x":299,"y":286},{"x":304,"y":282},{"x":306,"y":283},{"x":311,"y":280},{"x":318,"y":270},{"x":318,"y":266},{"x":322,"y":257},{"x":321,"y":253},{"x":324,"y":255},{"x":334,"y":265},{"x":340,"y":272},{"x":342,"y":282},{"x":349,"y":289},{"x":336,"y":303},{"x":336,"y":307},{"x":334,"y":310},{"x":334,"y":314},{"x":331,"y":321},{"x":320,"y":316},{"x":314,"y":314},{"x":306,"y":313},{"x":300,"y":311},{"x":298,"y":312},{"x":281,"y":312},{"x":279,"y":309},{"x":269,"y":310},{"x":266,"y":307},{"x":261,"y":305},{"x":259,"y":303},{"x":258,"y":299},{"x":259,"y":297},{"x":261,"y":294},{"x":265,"y":291},{"x":269,"y":289},{"x":271,"y":282}],"connections":[21,31,33,37,30],"region":4},{"name":"Tarblade Bay","center":{"x":226.44117647058823,"y":291.02941176470586},"polygon":[{"x":240,"y":254},{"x":250,"y":266},{"x":258,"y":270},{"x":270,"y":277},{"x":271,"y":282},{"x":269,"y":289},{"x":265,"y":291},{"x":261,"y":294},{"x":259,"y":297},{"x":258,"y":299},{"x":259,"y":303},{"x":261,"y":305},{"x":258,"y":305},{"x":247,"y":307},{"x":230,"y":313},{"x":225,"y":313},{"x":220,"y":317},{"x":208,"y":318},{"x":194,"y":319},{"x":187,"y":316},{"x":170,"y":313},{"x":171,"y":311},{"x":178,"y":302},{"x":185,"y":290},{"x":189,"y":283},{"x":196,"y":275},{"x":201,"y":274},{"x":206,"y":275},{"x":208,"y":276},{"x":213,"y":276},{"x":214,"y":277},{"x":219,"y":276},{"x":225,"y":270},{"x":234,"y":262}],"connections":[31,32,34,38,9,2],"region":4},{"name":"Crew Haven","center":{"x":214.19230769230768,"y":335.53846153846155},"polygon":[{"x":170,"y":313},{"x":187,"y":316},{"x":194,"y":319},{"x":208,"y":318},{"x":220,"y":317},{"x":225,"y":313},{"x":230,"y":313},{"x":247,"y":307},{"x":258,"y":305},{"x":258,"y":311},{"x":260,"y":322},{"x":262,"y":330},{"x":261,"y":349},{"x":263,"y":353},{"x":253,"y":353},{"x":245,"y":356},{"x":233,"y":358},{"x":213,"y":358},{"x":197,"y":367},{"x":196,"y":365},{"x":189,"y":363},{"x":175,"y":363},{"x":150,"y":352},{"x":155,"y":341},{"x":155,"y":338},{"x":165,"y":324}],"connections":[33,37,36,35],"region":4},{"name":"Faltre","center":{"x":173.89285714285714,"y":409.89285714285717},"polygon":[{"x":150,"y":352},{"x":175,"y":363},{"x":189,"y":363},{"x":196,"y":365},{"x":197,"y":367},{"x":194,"y":371},{"x":191,"y":376},{"x":188,"y":388},{"x":188,"y":402},{"x":194,"y":416},{"x":201,"y":430},{"x":205,"y":441},{"x":199,"y":448},{"x":193,"y":452},{"x":188,"y":460},{"x":188,"y":464},{"x":176,"y":474},{"x":166,"y":467},{"x":160,"y":455},{"x":159,"y":444},{"x":160,"y":430},{"x":156,"y":417},{"x":147,"y":407},{"x":142,"y":399},{"x":144,"y":397},{"x":139,"y":389},{"x":139,"y":375},{"x":145,"y":365}],"connections":[34,36,38],"region":4},{"name":"Corkskrew","center":{"x":226.64,"y":395.76},"polygon":[{"x":205,"y":441},{"x":201,"y":430},{"x":194,"y":416},{"x":188,"y":402},{"x":188,"y":388},{"x":191,"y":376},{"x":194,"y":371},{"x":197,"y":367},{"x":213,"y":358},{"x":233,"y":358},{"x":245,"y":356},{"x":253,"y":353},{"x":263,"y":353},{"x":264,"y":362},{"x":261,"y":372},{"x":260,"y":397},{"x":262,"y":402},{"x":257,"y":407},{"x":247,"y":411},{"x":241,"y":420},{"x":232,"y":424},{"x":228,"y":425},{"x":220,"y":430},{"x":217,"y":437},{"x":212,"y":438}],"connections":[39,37,34,35,38],"region":4},{"name":"Pockit","center":{"x":288.09090909090907,"y":343.7878787878788},"polygon":[{"x":262,"y":402},{"x":260,"y":397},{"x":261,"y":372},{"x":264,"y":362},{"x":263,"y":353},{"x":261,"y":349},{"x":262,"y":330},{"x":260,"y":322},{"x":258,"y":311},{"x":258,"y":305},{"x":261,"y":305},{"x":266,"y":307},{"x":269,"y":310},{"x":279,"y":309},{"x":281,"y":312},{"x":298,"y":312},{"x":300,"y":311},{"x":306,"y":313},{"x":314,"y":314},{"x":320,"y":316},{"x":331,"y":321},{"x":330,"y":325},{"x":326,"y":335},{"x":327,"y":342},{"x":324,"y":347},{"x":320,"y":364},{"x":320,"y":371},{"x":310,"y":373},{"x":299,"y":378},{"x":289,"y":387},{"x":285,"y":394},{"x":275,"y":398},{"x":268,"y":398}],"connections":[21,34,32,40,36],"region":4},{"name":"Sparling","center":{"x":193.84,"y":492.52},"polygon":[{"x":176,"y":474},{"x":188,"y":464},{"x":188,"y":460},{"x":193,"y":452},{"x":199,"y":448},{"x":205,"y":441},{"x":212,"y":438},{"x":217,"y":437},{"x":235,"y":469},{"x":229,"y":481},{"x":229,"y":490},{"x":224,"y":499},{"x":214,"y":507},{"x":203,"y":513},{"x":198,"y":515},{"x":192,"y":520},{"x":189,"y":529},{"x":171,"y":536},{"x":169,"y":541},{"x":165,"y":544},{"x":164,"y":528},{"x":168,"y":520},{"x":169,"y":511},{"x":173,"y":506},{"x":176,"y":490}],"connections":[35,39,36,41,33],"region":5},{"name":"Foxe","center":{"x":251.44827586206895,"y":464.6896551724138},"polygon":[{"x":214,"y":507},{"x":224,"y":499},{"x":229,"y":490},{"x":229,"y":481},{"x":235,"y":469},{"x":217,"y":437},{"x":220,"y":430},{"x":228,"y":425},{"x":232,"y":424},{"x":241,"y":420},{"x":247,"y":411},{"x":257,"y":407},{"x":262,"y":402},{"x":263,"y":408},{"x":263,"y":432},{"x":269,"y":449},{"x":269,"y":458},{"x":267,"y":468},{"x":271,"y":471},{"x":273,"y":476},{"x":276,"y":478},{"x":295,"y":491},{"x":292,"y":499},{"x":283,"y":507},{"x":273,"y":510},{"x":257,"y":511},{"x":242,"y":507},{"x":234,"y":504},{"x":230,"y":505}],"connections":[40,36,38,41,42],"region":5},{"name":"Espoo","center":{"x":308.72222222222223,"y":446},"polygon":[{"x":295,"y":491},{"x":276,"y":478},{"x":273,"y":476},{"x":271,"y":471},{"x":267,"y":468},{"x":269,"y":458},{"x":269,"y":449},{"x":263,"y":432},{"x":263,"y":408},{"x":262,"y":402},{"x":268,"y":398},{"x":275,"y":398},{"x":285,"y":394},{"x":289,"y":387},{"x":299,"y":378},{"x":310,"y":373},{"x":320,"y":371},{"x":315,"y":383},{"x":315,"y":398},{"x":315,"y":403},{"x":311,"y":413},{"x":312,"y":423},{"x":314,"y":430},{"x":314,"y":438},{"x":318,"y":447},{"x":332,"y":460},{"x":340,"y":465},{"x":353,"y":477},{"x":361,"y":483},{"x":377,"y":508},{"x":377,"y":511},{"x":362,"y":523},{"x":353,"y":527},{"x":344,"y":523},{"x":327,"y":509},{"x":320,"y":503}],"connections":[37,48,49,45,42,39],"region":5},{"name":"Mendip Hills","center":{"x":200.07692307692307,"y":549.7307692307693},"polygon":[{"x":165,"y":544},{"x":169,"y":541},{"x":171,"y":536},{"x":189,"y":529},{"x":192,"y":520},{"x":198,"y":515},{"x":203,"y":513},{"x":214,"y":507},{"x":230,"y":505},{"x":230,"y":512},{"x":232,"y":519},{"x":233,"y":525},{"x":233,"y":529},{"x":233,"y":540},{"x":234,"y":566},{"x":230,"y":569},{"x":219,"y":572},{"x":207,"y":576},{"x":195,"y":573},{"x":184,"y":577},{"x":180,"y":582},{"x":179,"y":592},{"x":177,"y":596},{"x":170,"y":601},{"x":167,"y":585},{"x":168,"y":569}],"connections":[39,38,42,43],"region":5},{"name":"Kargasok","center":{"x":285.24242424242425,"y":546.5151515151515},"polygon":[{"x":234,"y":566},{"x":233,"y":540},{"x":233,"y":529},{"x":233,"y":525},{"x":232,"y":519},{"x":230,"y":512},{"x":230,"y":505},{"x":234,"y":504},{"x":242,"y":507},{"x":257,"y":511},{"x":273,"y":510},{"x":283,"y":507},{"x":292,"y":499},{"x":295,"y":491},{"x":320,"y":503},{"x":327,"y":509},{"x":344,"y":523},{"x":340,"y":529},{"x":335,"y":542},{"x":330,"y":550},{"x":331,"y":557},{"x":329,"y":561},{"x":332,"y":567},{"x":326,"y":571},{"x":313,"y":588},{"x":312,"y":598},{"x":306,"y":614},{"x":303,"y":626},{"x":298,"y":629},{"x":273,"y":597},{"x":272,"y":589},{"x":264,"y":582},{"x":257,"y":575}],"connections":[40,41,39,45,44,43],"region":5},{"name":"Gainford","center":{"x":228.38095238095238,"y":600.4761904761905},"polygon":[{"x":170,"y":601},{"x":177,"y":596},{"x":179,"y":592},{"x":180,"y":582},{"x":184,"y":577},{"x":195,"y":573},{"x":207,"y":576},{"x":219,"y":572},{"x":230,"y":569},{"x":234,"y":566},{"x":257,"y":575},{"x":264,"y":582},{"x":272,"y":589},{"x":273,"y":597},{"x":298,"y":629},{"x":297,"y":633},{"x":302,"y":641},{"x":304,"y":657},{"x":198,"y":657},{"x":181,"y":632},{"x":175,"y":614}],"connections":[42,41,44],"region":5},{"name":"Crail","center":{"x":338.9375,"y":616.0625},"polygon":[{"x":304,"y":657},{"x":302,"y":641},{"x":297,"y":633},{"x":298,"y":629},{"x":303,"y":626},{"x":306,"y":614},{"x":312,"y":598},{"x":313,"y":588},{"x":326,"y":571},{"x":332,"y":567},{"x":353,"y":583},{"x":393,"y":611},{"x":400,"y":619},{"x":393,"y":628},{"x":391,"y":635},{"x":400,"y":657}],"connections":[42,43,45,46],"region":5},{"name":"Volberg","center":{"x":391.44827586206895,"y":560.1379310344828},"polygon":[{"x":400,"y":619},{"x":393,"y":611},{"x":353,"y":583},{"x":332,"y":567},{"x":329,"y":561},{"x":331,"y":557},{"x":330,"y":550},{"x":335,"y":542},{"x":340,"y":529},{"x":344,"y":523},{"x":353,"y":527},{"x":362,"y":523},{"x":377,"y":511},{"x":382,"y":515},{"x":392,"y":528},{"x":396,"y":528},{"x":417,"y":544},{"x":423,"y":546},{"x":428,"y":550},{"x":443,"y":555},{"x":444,"y":558},{"x":439,"y":567},{"x":439,"y":581},{"x":444,"y":587},{"x":439,"y":591},{"x":430,"y":591},{"x":426,"y":596},{"x":418,"y":597},{"x":413,"y":607}],"connections":[40,42,44,49,47,46],"region":5},{"name":"Clay Cross","center":{"x":471.6818181818182,"y":622},"polygon":[{"x":400,"y":657},{"x":391,"y":635},{"x":393,"y":628},{"x":400,"y":619},{"x":413,"y":607},{"x":418,"y":597},{"x":426,"y":596},{"x":430,"y":591},{"x":439,"y":591},{"x":444,"y":587},{"x":467,"y":605},{"x":474,"y":607},{"x":483,"y":612},{"x":489,"y":620},{"x":497,"y":626},{"x":515,"y":634},{"x":521,"y":635},{"x":539,"y":636},{"x":548,"y":643},{"x":554,"y":649},{"x":570,"y":652},{"x":566,"y":657}],"connections":[44,45,47,82],"region":5},{"name":"Batchtown","center":{"x":497.27027027027026,"y":576.8918918918919},"polygon":[{"x":539,"y":636},{"x":521,"y":635},{"x":515,"y":634},{"x":497,"y":626},{"x":489,"y":620},{"x":483,"y":612},{"x":474,"y":607},{"x":467,"y":605},{"x":444,"y":587},{"x":439,"y":581},{"x":439,"y":567},{"x":444,"y":558},{"x":443,"y":555},{"x":447,"y":551},{"x":447,"y":544},{"x":452,"y":539},{"x":458,"y":535},{"x":465,"y":535},{"x":478,"y":541},{"x":482,"y":541},{"x":494,"y":547},{"x":500,"y":547},{"x":505,"y":549},{"x":516,"y":547},{"x":525,"y":544},{"x":528,"y":546},{"x":527,"y":550},{"x":536,"y":560},{"x":537,"y":568},{"x":540,"y":575},{"x":540,"y":578},{"x":538,"y":583},{"x":540,"y":590},{"x":538,"y":603},{"x":535,"y":609},{"x":539,"y":615},{"x":538,"y":625}],"connections":[82,84,68,45,49,51,46],"region":5},{"name":"Wynwood","center":{"x":361.3888888888889,"y":406.8888888888889},"polygon":[{"x":332,"y":460},{"x":318,"y":447},{"x":314,"y":438},{"x":314,"y":430},{"x":312,"y":423},{"x":311,"y":413},{"x":315,"y":403},{"x":315,"y":398},{"x":315,"y":383},{"x":320,"y":371},{"x":328,"y":370},{"x":335,"y":372},{"x":340,"y":370},{"x":350,"y":373},{"x":355,"y":372},{"x":360,"y":368},{"x":362,"y":370},{"x":373,"y":371},{"x":377,"y":374},{"x":387,"y":369},{"x":393,"y":370},{"x":403,"y":366},{"x":418,"y":374},{"x":410,"y":390},{"x":413,"y":418},{"x":412,"y":422},{"x":415,"y":428},{"x":412,"y":441},{"x":414,"y":451},{"x":396,"y":442},{"x":394,"y":443},{"x":392,"y":441},{"x":374,"y":442},{"x":355,"y":442},{"x":342,"y":448},{"x":334,"y":455}],"connections":[28,21,40,49,50],"region":9},{"name":"Navenstill","center":{"x":402.76666666666665,"y":495.6666666666667},"polygon":[{"x":452,"y":539},{"x":447,"y":544},{"x":447,"y":551},{"x":443,"y":555},{"x":428,"y":550},{"x":423,"y":546},{"x":417,"y":544},{"x":396,"y":528},{"x":392,"y":528},{"x":382,"y":515},{"x":377,"y":511},{"x":377,"y":508},{"x":361,"y":483},{"x":353,"y":477},{"x":340,"y":465},{"x":332,"y":460},{"x":334,"y":455},{"x":342,"y":448},{"x":355,"y":442},{"x":374,"y":442},{"x":392,"y":441},{"x":394,"y":443},{"x":396,"y":442},{"x":414,"y":451},{"x":432,"y":460},{"x":445,"y":477},{"x":459,"y":504},{"x":469,"y":513},{"x":459,"y":518},{"x":451,"y":530}],"connections":[40,45,48,50,51,47],"region":9},{"name":"Millerovo","center":{"x":462.61290322580646,"y":428.96774193548384},"polygon":[{"x":469,"y":513},{"x":459,"y":504},{"x":445,"y":477},{"x":432,"y":460},{"x":414,"y":451},{"x":412,"y":441},{"x":415,"y":428},{"x":412,"y":422},{"x":413,"y":418},{"x":410,"y":390},{"x":418,"y":374},{"x":443,"y":373},{"x":458,"y":373},{"x":466,"y":369},{"x":483,"y":366},{"x":488,"y":367},{"x":487,"y":373},{"x":491,"y":386},{"x":488,"y":394},{"x":489,"y":405},{"x":491,"y":407},{"x":491,"y":412},{"x":487,"y":417},{"x":479,"y":430},{"x":482,"y":445},{"x":484,"y":447},{"x":483,"y":465},{"x":490,"y":485},{"x":499,"y":494},{"x":484,"y":501},{"x":479,"y":511}],"connections":[28,49,48,52,51],"region":9},{"name":"Pyrth","center":{"x":495.54545454545456,"y":528.7727272727273},"polygon":[{"x":525,"y":544},{"x":516,"y":547},{"x":505,"y":549},{"x":500,"y":547},{"x":494,"y":547},{"x":482,"y":541},{"x":478,"y":541},{"x":465,"y":535},{"x":458,"y":535},{"x":452,"y":539},{"x":451,"y":530},{"x":459,"y":518},{"x":469,"y":513},{"x":479,"y":511},{"x":484,"y":501},{"x":499,"y":494},{"x":517,"y":500},{"x":534,"y":512},{"x":537,"y":520},{"x":534,"y":532},{"x":534,"y":536},{"x":530,"y":541}],"connections":[68,50,49,47,52],"region":9},{"name":"Benton","center":{"x":510.6363636363636,"y":431.3939393939394},"polygon":[{"x":534,"y":512},{"x":517,"y":500},{"x":499,"y":494},{"x":490,"y":485},{"x":483,"y":465},{"x":484,"y":447},{"x":482,"y":445},{"x":479,"y":430},{"x":487,"y":417},{"x":491,"y":412},{"x":491,"y":407},{"x":489,"y":405},{"x":488,"y":394},{"x":491,"y":386},{"x":487,"y":373},{"x":488,"y":367},{"x":493,"y":367},{"x":514,"y":377},{"x":520,"y":376},{"x":525,"y":373},{"x":523,"y":388},{"x":527,"y":393},{"x":523,"y":408},{"x":531,"y":423},{"x":532,"y":431},{"x":537,"y":436},{"x":540,"y":441},{"x":539,"y":462},{"x":536,"y":467},{"x":537,"y":474},{"x":530,"y":487},{"x":532,"y":491},{"x":532,"y":503}],"connections":[66,28,67,68,50,51],"region":9},{"name":"Upper Hutt","center":{"x":570.475,"y":187.65},"polygon":[{"x":531,"y":195},{"x":532,"y":192},{"x":534,"y":186},{"x":532,"y":183},{"x":531,"y":179},{"x":530,"y":174},{"x":526,"y":170},{"x":524,"y":156},{"x":526,"y":149},{"x":525,"y":146},{"x":535,"y":133},{"x":543,"y":139},{"x":555,"y":146},{"x":581,"y":144},{"x":590,"y":150},{"x":604,"y":156},{"x":613,"y":155},{"x":615,"y":160},{"x":612,"y":168},{"x":606,"y":175},{"x":606,"y":180},{"x":608,"y":184},{"x":609,"y":190},{"x":607,"y":197},{"x":607,"y":202},{"x":605,"y":206},{"x":601,"y":214},{"x":599,"y":220},{"x":594,"y":228},{"x":595,"y":233},{"x":587,"y":243},{"x":581,"y":239},{"x":573,"y":229},{"x":573,"y":225},{"x":567,"y":218},{"x":559,"y":215},{"x":558,"y":212},{"x":557,"y":210},{"x":547,"y":206},{"x":541,"y":199}],"connections":[16,13,24,56,54,57,25],"region":10},{"name":"Lower Hutt","center":{"x":549.8095238095239,"y":252.1904761904762},"polygon":[{"x":524,"y":286},{"x":521,"y":284},{"x":521,"y":280},{"x":524,"y":277},{"x":524,"y":268},{"x":522,"y":262},{"x":523,"y":252},{"x":525,"y":246},{"x":525,"y":240},{"x":525,"y":234},{"x":526,"y":230},{"x":524,"y":225},{"x":527,"y":219},{"x":527,"y":212},{"x":530,"y":206},{"x":528,"y":202},{"x":531,"y":195},{"x":541,"y":199},{"x":547,"y":206},{"x":557,"y":210},{"x":558,"y":212},{"x":559,"y":215},{"x":567,"y":218},{"x":573,"y":225},{"x":573,"y":229},{"x":581,"y":239},{"x":587,"y":243},{"x":587,"y":247},{"x":586,"y":251},{"x":586,"y":267},{"x":577,"y":278},{"x":576,"y":284},{"x":571,"y":288},{"x":572,"y":291},{"x":572,"y":295},{"x":574,"y":298},{"x":570,"y":301},{"x":568,"y":304},{"x":559,"y":298},{"x":546,"y":296},{"x":545,"y":293},{"x":533,"y":287}],"connections":[26,25,53,58,55],"region":10},{"name":"Yug","center":{"x":543.3333333333334,"y":318.76190476190476},"polygon":[{"x":524,"y":343},{"x":525,"y":333},{"x":522,"y":327},{"x":520,"y":323},{"x":523,"y":315},{"x":522,"y":312},{"x":524,"y":303},{"x":522,"y":300},{"x":524,"y":286},{"x":533,"y":287},{"x":545,"y":293},{"x":546,"y":296},{"x":559,"y":298},{"x":568,"y":304},{"x":570,"y":309},{"x":572,"y":336},{"x":574,"y":340},{"x":572,"y":346},{"x":564,"y":348},{"x":555,"y":347},{"x":546,"y":348}],"connections":[54,58,66,27,26,28],"region":10},{"name":"Grey Town","center":{"x":625.8,"y":179.04},"polygon":[{"x":599,"y":220},{"x":601,"y":214},{"x":605,"y":206},{"x":607,"y":202},{"x":607,"y":197},{"x":609,"y":190},{"x":608,"y":184},{"x":606,"y":180},{"x":606,"y":175},{"x":612,"y":168},{"x":615,"y":160},{"x":613,"y":155},{"x":621,"y":153},{"x":636,"y":153},{"x":638,"y":149},{"x":655,"y":151},{"x":659,"y":150},{"x":663,"y":149},{"x":663,"y":156},{"x":656,"y":168},{"x":656,"y":177},{"x":644,"y":183},{"x":637,"y":194},{"x":623,"y":217},{"x":606,"y":225}],"connections":[53,57,59],"region":10},{"name":"Vendingham","center":{"x":636.0322580645161,"y":238.09677419354838},"polygon":[{"x":587,"y":243},{"x":595,"y":233},{"x":594,"y":228},{"x":599,"y":220},{"x":606,"y":225},{"x":623,"y":217},{"x":637,"y":194},{"x":644,"y":183},{"x":648,"y":186},{"x":656,"y":189},{"x":668,"y":198},{"x":672,"y":200},{"x":686,"y":210},{"x":692,"y":212},{"x":684,"y":216},{"x":674,"y":228},{"x":674,"y":235},{"x":668,"y":244},{"x":660,"y":249},{"x":650,"y":260},{"x":652,"y":277},{"x":647,"y":289},{"x":640,"y":298},{"x":631,"y":290},{"x":622,"y":286},{"x":618,"y":276},{"x":606,"y":269},{"x":601,"y":266},{"x":599,"y":259},{"x":592,"y":254},{"x":592,"y":247}],"connections":[58,53,56,59,60],"region":10},{"name":"Shapper's Glen","center":{"x":600.8947368421053,"y":303.7368421052632},"polygon":[{"x":572,"y":346},{"x":574,"y":340},{"x":572,"y":336},{"x":570,"y":309},{"x":568,"y":304},{"x":570,"y":301},{"x":574,"y":298},{"x":572,"y":295},{"x":572,"y":291},{"x":571,"y":288},{"x":576,"y":284},{"x":577,"y":278},{"x":586,"y":267},{"x":586,"y":251},{"x":587,"y":247},{"x":587,"y":243},{"x":592,"y":247},{"x":592,"y":254},{"x":599,"y":259},{"x":601,"y":266},{"x":606,"y":269},{"x":618,"y":276},{"x":622,"y":286},{"x":631,"y":290},{"x":640,"y":298},{"x":646,"y":310},{"x":646,"y":321},{"x":654,"y":327},{"x":655,"y":339},{"x":645,"y":345},{"x":642,"y":351},{"x":634,"y":347},{"x":619,"y":346},{"x":617,"y":348},{"x":604,"y":347},{"x":594,"y":345},{"x":583,"y":345},{"x":580,"y":348}],"connections":[54,55,57,61,69,66],"region":10},{"name":"Bick Piney","center":{"x":711.5405405405405,"y":169.54054054054055},"polygon":[{"x":692,"y":212},{"x":686,"y":210},{"x":672,"y":200},{"x":668,"y":198},{"x":656,"y":189},{"x":648,"y":186},{"x":644,"y":183},{"x":656,"y":177},{"x":656,"y":168},{"x":663,"y":156},{"x":663,"y":149},{"x":672,"y":148},{"x":676,"y":145},{"x":681,"y":147},{"x":690,"y":138},{"x":698,"y":131},{"x":699,"y":127},{"x":702,"y":125},{"x":711,"y":128},{"x":727,"y":129},{"x":733,"y":135},{"x":744,"y":138},{"x":750,"y":141},{"x":757,"y":138},{"x":760,"y":141},{"x":764,"y":142},{"x":764,"y":151},{"x":762,"y":154},{"x":760,"y":173},{"x":760,"y":191},{"x":762,"y":196},{"x":760,"y":208},{"x":756,"y":221},{"x":758,"y":235},{"x":739,"y":225},{"x":723,"y":221},{"x":715,"y":217}],"connections":[56,57,60,63],"region":10},{"name":"Edisto","center":{"x":700.8333333333334,"y":254.875},"polygon":[{"x":640,"y":298},{"x":647,"y":289},{"x":652,"y":277},{"x":650,"y":260},{"x":660,"y":249},{"x":668,"y":244},{"x":674,"y":235},{"x":674,"y":228},{"x":684,"y":216},{"x":692,"y":212},{"x":715,"y":217},{"x":723,"y":221},{"x":739,"y":225},{"x":758,"y":235},{"x":756,"y":242},{"x":755,"y":246},{"x":754,"y":250},{"x":755,"y":257},{"x":746,"y":263},{"x":726,"y":289},{"x":715,"y":286},{"x":696,"y":287},{"x":681,"y":294},{"x":660,"y":297}],"connections":[59,57,61,63,62],"region":10},{"name":"Arendal","center":{"x":687.24,"y":321.48},"polygon":[{"x":655,"y":339},{"x":654,"y":327},{"x":646,"y":321},{"x":646,"y":310},{"x":640,"y":298},{"x":660,"y":297},{"x":681,"y":294},{"x":696,"y":287},{"x":715,"y":286},{"x":726,"y":289},{"x":723,"y":296},{"x":719,"y":302},{"x":719,"y":307},{"x":709,"y":323},{"x":709,"y":336},{"x":707,"y":338},{"x":707,"y":345},{"x":702,"y":349},{"x":699,"y":348},{"x":698,"y":345},{"x":687,"y":340},{"x":682,"y":342},{"x":672,"y":339},{"x":667,"y":341},{"x":662,"y":338}],"connections":[58,60,62,69],"region":10},{"name":"Siple","center":{"x":731.4827586206897,"y":318.55172413793105},"polygon":[{"x":702,"y":349},{"x":707,"y":345},{"x":707,"y":338},{"x":709,"y":336},{"x":709,"y":323},{"x":719,"y":307},{"x":719,"y":302},{"x":723,"y":296},{"x":726,"y":289},{"x":746,"y":263},{"x":755,"y":257},{"x":750,"y":264},{"x":752,"y":271},{"x":750,"y":278},{"x":746,"y":284},{"x":745,"y":302},{"x":748,"y":308},{"x":747,"y":316},{"x":745,"y":323},{"x":747,"y":327},{"x":743,"y":332},{"x":739,"y":339},{"x":737,"y":353},{"x":739,"y":358},{"x":732,"y":354},{"x":725,"y":356},{"x":718,"y":356},{"x":715,"y":358},{"x":713,"y":354}],"connections":[63,61,60,74,72,69],"region":10},{"name":"Babystook","center":{"x":782.4897959183673,"y":235.3265306122449},"polygon":[{"x":747,"y":327},{"x":745,"y":323},{"x":747,"y":316},{"x":748,"y":308},{"x":745,"y":302},{"x":746,"y":284},{"x":750,"y":278},{"x":752,"y":271},{"x":750,"y":264},{"x":755,"y":257},{"x":754,"y":250},{"x":755,"y":246},{"x":756,"y":242},{"x":758,"y":235},{"x":756,"y":221},{"x":760,"y":208},{"x":762,"y":196},{"x":760,"y":191},{"x":760,"y":173},{"x":762,"y":154},{"x":764,"y":151},{"x":764,"y":142},{"x":769,"y":143},{"x":772,"y":147},{"x":783,"y":151},{"x":790,"y":150},{"x":796,"y":158},{"x":812,"y":164},{"x":820,"y":164},{"x":825,"y":171},{"x":831,"y":188},{"x":836,"y":193},{"x":836,"y":197},{"x":842,"y":206},{"x":829,"y":217},{"x":823,"y":226},{"x":814,"y":228},{"x":804,"y":236},{"x":803,"y":243},{"x":795,"y":255},{"x":796,"y":266},{"x":802,"y":281},{"x":803,"y":296},{"x":808,"y":311},{"x":805,"y":316},{"x":807,"y":321},{"x":798,"y":323},{"x":781,"y":321},{"x":766,"y":320}],"connections":[59,60,62,64,74],"region":10},{"name":"Horndal","center":{"x":831.1538461538462,"y":270.7307692307692},"polygon":[{"x":807,"y":321},{"x":805,"y":316},{"x":808,"y":311},{"x":803,"y":296},{"x":802,"y":281},{"x":796,"y":266},{"x":795,"y":255},{"x":803,"y":243},{"x":804,"y":236},{"x":814,"y":228},{"x":823,"y":226},{"x":829,"y":217},{"x":842,"y":206},{"x":848,"y":225},{"x":849,"y":234},{"x":860,"y":244},{"x":870,"y":247},{"x":874,"y":256},{"x":879,"y":268},{"x":866,"y":281},{"x":852,"y":300},{"x":850,"y":299},{"x":839,"y":317},{"x":838,"y":325},{"x":833,"y":322},{"x":821,"y":319}],"connections":[63,79,74],"region":10},{"name":"Haffinder","center":{"x":579.8823529411765,"y":382.88235294117646},"polygon":[{"x":565,"y":366},{"x":556,"y":370},{"x":554,"y":370},{"x":544,"y":378},{"x":542,"y":385},{"x":543,"y":393},{"x":551,"y":398},{"x":577,"y":401},{"x":583,"y":405},{"x":591,"y":402},{"x":621,"y":396},{"x":626,"y":391},{"x":627,"y":381},{"x":622,"y":373},{"x":605,"y":365},{"x":581,"y":366},{"x":570,"y":369}],"connections":[66],"region":11},{"name":"Eekenbleek","center":{"x":585.0769230769231,"y":423.7692307692308},"polygon":[{"x":537,"y":436},{"x":532,"y":431},{"x":531,"y":423},{"x":523,"y":408},{"x":527,"y":393},{"x":523,"y":388},{"x":525,"y":373},{"x":523,"y":367},{"x":526,"y":362},{"x":525,"y":355},{"x":523,"y":349},{"x":524,"y":343},{"x":528,"y":344},{"x":546,"y":348},{"x":555,"y":347},{"x":564,"y":348},{"x":572,"y":346},{"x":580,"y":348},{"x":583,"y":345},{"x":594,"y":345},{"x":604,"y":347},{"x":617,"y":348},{"x":619,"y":346},{"x":634,"y":347},{"x":642,"y":351},{"x":646,"y":355},{"x":648,"y":361},{"x":651,"y":366},{"x":654,"y":369},{"x":655,"y":388},{"x":658,"y":390},{"x":657,"y":394},{"x":658,"y":407},{"x":639,"y":418},{"x":618,"y":432},{"x":614,"y":438},{"x":603,"y":440},{"x":587,"y":440},{"x":573,"y":436}],"connections":[69,65,70,67,52,28,55,58],"region":11},{"name":"Vir","center":{"x":585.3913043478261,"y":461.95652173913044},"polygon":[{"x":532,"y":491},{"x":530,"y":487},{"x":537,"y":474},{"x":536,"y":467},{"x":539,"y":462},{"x":540,"y":441},{"x":537,"y":436},{"x":573,"y":436},{"x":587,"y":440},{"x":603,"y":440},{"x":614,"y":438},{"x":612,"y":443},{"x":615,"y":448},{"x":622,"y":453},{"x":636,"y":455},{"x":641,"y":458},{"x":637,"y":467},{"x":633,"y":465},{"x":624,"y":473},{"x":607,"y":481},{"x":590,"y":488},{"x":570,"y":491},{"x":549,"y":491}],"connections":[66,52,70,71,68],"region":11},{"name":"Hawk's Nest","center":{"x":588.9615384615385,"y":506.88461538461536},"polygon":[{"x":528,"y":546},{"x":525,"y":544},{"x":530,"y":541},{"x":534,"y":536},{"x":534,"y":532},{"x":537,"y":520},{"x":534,"y":512},{"x":533,"y":508},{"x":532,"y":503},{"x":532,"y":491},{"x":549,"y":491},{"x":570,"y":491},{"x":590,"y":488},{"x":607,"y":481},{"x":624,"y":473},{"x":633,"y":465},{"x":637,"y":467},{"x":634,"y":476},{"x":637,"y":486},{"x":636,"y":492},{"x":639,"y":497},{"x":637,"y":517},{"x":640,"y":522},{"x":652,"y":528},{"x":661,"y":537},{"x":648,"y":535}],"connections":[67,71,84,47,51,52],"region":11},{"name":"Walpole","center":{"x":678.9677419354839,"y":368.258064516129},"polygon":[{"x":658,"y":407},{"x":657,"y":394},{"x":658,"y":390},{"x":655,"y":388},{"x":654,"y":369},{"x":651,"y":366},{"x":648,"y":361},{"x":646,"y":355},{"x":642,"y":351},{"x":645,"y":345},{"x":655,"y":339},{"x":662,"y":338},{"x":667,"y":341},{"x":672,"y":339},{"x":682,"y":342},{"x":687,"y":340},{"x":698,"y":345},{"x":699,"y":348},{"x":702,"y":349},{"x":713,"y":354},{"x":715,"y":358},{"x":719,"y":363},{"x":717,"y":374},{"x":717,"y":378},{"x":712,"y":381},{"x":704,"y":389},{"x":698,"y":391},{"x":692,"y":398},{"x":685,"y":401},{"x":671,"y":413},{"x":667,"y":409}],"connections":[70,72,61,62,58,66],"region":11},{"name":"Strum","center":{"x":654.55,"y":437.5},"polygon":[{"x":641,"y":458},{"x":636,"y":455},{"x":622,"y":453},{"x":615,"y":448},{"x":612,"y":443},{"x":614,"y":438},{"x":618,"y":432},{"x":639,"y":418},{"x":658,"y":407},{"x":667,"y":409},{"x":671,"y":413},{"x":674,"y":418},{"x":675,"y":428},{"x":693,"y":435},{"x":697,"y":438},{"x":694,"y":445},{"x":687,"y":445},{"x":672,"y":457},{"x":656,"y":456},{"x":650,"y":454}],"connections":[72,69,71,66,67],"region":11},{"name":"Pivolin","center":{"x":666.4347826086956,"y":495.30434782608694},"polygon":[{"x":661,"y":537},{"x":652,"y":528},{"x":640,"y":522},{"x":637,"y":517},{"x":639,"y":497},{"x":636,"y":492},{"x":637,"y":486},{"x":634,"y":476},{"x":637,"y":467},{"x":641,"y":458},{"x":650,"y":454},{"x":656,"y":456},{"x":672,"y":457},{"x":687,"y":445},{"x":694,"y":445},{"x":700,"y":451},{"x":709,"y":481},{"x":709,"y":522},{"x":707,"y":532},{"x":702,"y":539},{"x":688,"y":544},{"x":673,"y":545},{"x":667,"y":541}],"connections":[73,85,72,70,67,68,84],"region":11},{"name":"Disko","center":{"x":716.7096774193549,"y":399.741935483871},"polygon":[{"x":700,"y":451},{"x":694,"y":445},{"x":697,"y":438},{"x":693,"y":435},{"x":675,"y":428},{"x":674,"y":418},{"x":671,"y":413},{"x":685,"y":401},{"x":692,"y":398},{"x":698,"y":391},{"x":704,"y":389},{"x":712,"y":381},{"x":717,"y":378},{"x":717,"y":374},{"x":719,"y":363},{"x":715,"y":358},{"x":718,"y":356},{"x":725,"y":356},{"x":732,"y":354},{"x":739,"y":358},{"x":746,"y":361},{"x":745,"y":370},{"x":746,"y":374},{"x":743,"y":383},{"x":742,"y":398},{"x":742,"y":414},{"x":741,"y":430},{"x":743,"y":435},{"x":741,"y":442},{"x":736,"y":448},{"x":716,"y":452}],"connections":[74,62,75,73,71,70,69],"region":11},{"name":"Tinwald","center":{"x":730.4615384615385,"y":491.9230769230769},"polygon":[{"x":702,"y":539},{"x":707,"y":532},{"x":709,"y":522},{"x":709,"y":481},{"x":700,"y":451},{"x":716,"y":452},{"x":736,"y":448},{"x":741,"y":442},{"x":758,"y":449},{"x":768,"y":479},{"x":777,"y":531},{"x":747,"y":534},{"x":726,"y":535}],"connections":[86,85,76,75,72,71],"region":11},{"name":"Fidelio","center":{"x":789.1071428571429,"y":352.32142857142856},"polygon":[{"x":742,"y":398},{"x":743,"y":383},{"x":746,"y":374},{"x":745,"y":370},{"x":746,"y":361},{"x":739,"y":358},{"x":737,"y":353},{"x":739,"y":339},{"x":743,"y":332},{"x":747,"y":327},{"x":751,"y":327},{"x":766,"y":320},{"x":781,"y":321},{"x":798,"y":323},{"x":807,"y":321},{"x":821,"y":319},{"x":833,"y":322},{"x":838,"y":325},{"x":850,"y":336},{"x":847,"y":354},{"x":849,"y":358},{"x":846,"y":364},{"x":843,"y":368},{"x":830,"y":372},{"x":821,"y":372},{"x":810,"y":376},{"x":795,"y":393},{"x":782,"y":399}],"connections":[78,79,64,63,62,72,75],"region":11},{"name":"Wolverton","center":{"x":783.7777777777778,"y":435.05555555555554},"polygon":[{"x":768,"y":479},{"x":758,"y":449},{"x":741,"y":442},{"x":743,"y":435},{"x":741,"y":430},{"x":742,"y":414},{"x":742,"y":398},{"x":782,"y":399},{"x":795,"y":393},{"x":807,"y":411},{"x":812,"y":430},{"x":822,"y":435},{"x":825,"y":434},{"x":826,"y":438},{"x":819,"y":449},{"x":811,"y":454},{"x":793,"y":464},{"x":781,"y":477}],"connections":[72,78,77,76,73,74],"region":11},{"name":"Flen","center":{"x":816.6,"y":503},"polygon":[{"x":777,"y":531},{"x":768,"y":479},{"x":781,"y":477},{"x":793,"y":464},{"x":811,"y":454},{"x":851,"y":507},{"x":858,"y":523},{"x":856,"y":532},{"x":850,"y":533},{"x":821,"y":530}],"connections":[75,77,90,86,73],"region":11},{"name":"Brae","center":{"x":862.2105263157895,"y":472.2105263157895},"polygon":[{"x":856,"y":532},{"x":858,"y":523},{"x":851,"y":507},{"x":811,"y":454},{"x":819,"y":449},{"x":826,"y":438},{"x":825,"y":434},{"x":838,"y":435},{"x":847,"y":431},{"x":855,"y":421},{"x":858,"y":422},{"x":858,"y":428},{"x":875,"y":451},{"x":893,"y":457},{"x":916,"y":489},{"x":919,"y":509},{"x":917,"y":527},{"x":895,"y":531},{"x":865,"y":534}],"connections":[78,75,76,81,91,90],"region":11},{"name":"Twinbridge","center":{"x":842.8571428571429,"y":402.3809523809524},"polygon":[{"x":858,"y":422},{"x":855,"y":421},{"x":847,"y":431},{"x":838,"y":435},{"x":825,"y":434},{"x":822,"y":435},{"x":812,"y":430},{"x":807,"y":411},{"x":795,"y":393},{"x":810,"y":376},{"x":821,"y":372},{"x":830,"y":372},{"x":843,"y":368},{"x":846,"y":364},{"x":860,"y":369},{"x":869,"y":375},{"x":876,"y":386},{"x":880,"y":401},{"x":874,"y":416},{"x":871,"y":419},{"x":861,"y":420}],"connections":[79,80,74,75,81,77],"region":11},{"name":"Enderby","center":{"x":877.695652173913,"y":324.5217391304348},"polygon":[{"x":869,"y":375},{"x":860,"y":369},{"x":846,"y":364},{"x":849,"y":358},{"x":847,"y":354},{"x":850,"y":336},{"x":838,"y":325},{"x":839,"y":317},{"x":850,"y":299},{"x":852,"y":300},{"x":866,"y":281},{"x":879,"y":268},{"x":881,"y":268},{"x":903,"y":296},{"x":910,"y":294},{"x":915,"y":297},{"x":914,"y":312},{"x":917,"y":316},{"x":913,"y":328},{"x":916,"y":338},{"x":904,"y":342},{"x":887,"y":363},{"x":882,"y":364}],"connections":[64,80,78,74],"region":11},{"name":"Hornsham","center":{"x":911.7368421052631,"y":384.42105263157896},"polygon":[{"x":874,"y":416},{"x":880,"y":401},{"x":876,"y":386},{"x":869,"y":375},{"x":882,"y":364},{"x":887,"y":363},{"x":904,"y":342},{"x":916,"y":338},{"x":920,"y":348},{"x":936,"y":359},{"x":942,"y":364},{"x":946,"y":390},{"x":947,"y":393},{"x":945,"y":404},{"x":949,"y":410},{"x":939,"y":408},{"x":920,"y":412},{"x":904,"y":413},{"x":887,"y":418}],"connections":[79,78,81],"region":11},{"name":"Woody Head","center":{"x":923.5555555555555,"y":464.037037037037},"polygon":[{"x":917,"y":527},{"x":919,"y":509},{"x":916,"y":489},{"x":893,"y":457},{"x":875,"y":451},{"x":858,"y":428},{"x":858,"y":422},{"x":861,"y":420},{"x":871,"y":419},{"x":874,"y":416},{"x":887,"y":418},{"x":904,"y":413},{"x":920,"y":412},{"x":939,"y":408},{"x":949,"y":410},{"x":953,"y":418},{"x":953,"y":442},{"x":957,"y":449},{"x":956,"y":475},{"x":961,"y":480},{"x":968,"y":496},{"x":971,"y":507},{"x":965,"y":527},{"x":966,"y":534},{"x":963,"y":540},{"x":952,"y":532},{"x":930,"y":530}],"connections":[80,78,77,91],"region":11},{"name":"Sawtooth","center":{"x":561.6538461538462,"y":601},"polygon":[{"x":570,"y":652},{"x":554,"y":649},{"x":548,"y":643},{"x":539,"y":636},{"x":538,"y":625},{"x":539,"y":615},{"x":535,"y":609},{"x":538,"y":603},{"x":540,"y":590},{"x":538,"y":583},{"x":540,"y":578},{"x":540,"y":575},{"x":537,"y":568},{"x":536,"y":560},{"x":539,"y":561},{"x":552,"y":570},{"x":560,"y":573},{"x":568,"y":572},{"x":593,"y":584},{"x":607,"y":584},{"x":615,"y":588},{"x":612,"y":592},{"x":612,"y":597},{"x":594,"y":627},{"x":583,"y":640},{"x":576,"y":652}],"connections":[83,84,47,46],"region":12},{"name":"Townsend","center":{"x":619.3333333333334,"y":628.0555555555555},"polygon":[{"x":576,"y":652},{"x":583,"y":640},{"x":594,"y":627},{"x":612,"y":597},{"x":612,"y":592},{"x":615,"y":588},{"x":627,"y":596},{"x":649,"y":599},{"x":660,"y":604},{"x":659,"y":626},{"x":655,"y":636},{"x":656,"y":642},{"x":647,"y":647},{"x":626,"y":646},{"x":608,"y":651},{"x":600,"y":655},{"x":588,"y":653},{"x":581,"y":654}],"connections":[84,85,82],"region":12},{"name":"Lowenthal","center":{"x":603.6111111111111,"y":569.2777777777778},"polygon":[{"x":660,"y":604},{"x":649,"y":599},{"x":627,"y":596},{"x":615,"y":588},{"x":607,"y":584},{"x":593,"y":584},{"x":568,"y":572},{"x":560,"y":573},{"x":552,"y":570},{"x":539,"y":561},{"x":536,"y":560},{"x":527,"y":550},{"x":528,"y":546},{"x":648,"y":535},{"x":661,"y":537},{"x":667,"y":541},{"x":663,"y":562},{"x":665,"y":585}],"connections":[68,71,85,83,82,47],"region":12},{"name":"Magda","center":{"x":686.8095238095239,"y":596.1904761904761},"polygon":[{"x":656,"y":642},{"x":655,"y":636},{"x":659,"y":626},{"x":660,"y":604},{"x":665,"y":585},{"x":663,"y":562},{"x":667,"y":541},{"x":673,"y":545},{"x":688,"y":544},{"x":702,"y":539},{"x":726,"y":535},{"x":747,"y":534},{"x":741,"y":564},{"x":715,"y":645},{"x":705,"y":637},{"x":699,"y":634},{"x":693,"y":626},{"x":687,"y":623},{"x":679,"y":631},{"x":674,"y":629},{"x":669,"y":638}],"connections":[88,86,73,71,84,83],"region":12},{"name":"Harrenshade","center":{"x":794.4,"y":549.6},"polygon":[{"x":741,"y":564},{"x":747,"y":534},{"x":777,"y":531},{"x":821,"y":530},{"x":850,"y":533},{"x":847,"y":543},{"x":828,"y":578},{"x":812,"y":570},{"x":767,"y":557},{"x":754,"y":556}],"connections":[76,90,87,89,85,73],"region":12},{"name":"Obi","center":{"x":775.7272727272727,"y":591},"polygon":[{"x":741,"y":564},{"x":754,"y":556},{"x":767,"y":557},{"x":812,"y":570},{"x":800,"y":600},{"x":801,"y":604},{"x":797,"y":610},{"x":781,"y":620},{"x":771,"y":629},{"x":761,"y":607},{"x":748,"y":584}],"connections":[89,86,88],"region":12},{"name":"Dondra Head","center":{"x":751.1818181818181,"y":630.1818181818181},"polygon":[{"x":715,"y":645},{"x":741,"y":564},{"x":748,"y":584},{"x":761,"y":607},{"x":771,"y":629},{"x":783,"y":652},{"x":778,"y":654},{"x":762,"y":647},{"x":744,"y":650},{"x":735,"y":652},{"x":725,"y":648}],"connections":[87,89,85],"region":12},{"name":"Utta","center":{"x":822.0588235294117,"y":617.1176470588235},"polygon":[{"x":783,"y":652},{"x":771,"y":629},{"x":781,"y":620},{"x":797,"y":610},{"x":801,"y":604},{"x":800,"y":600},{"x":812,"y":570},{"x":828,"y":578},{"x":835,"y":583},{"x":872,"y":614},{"x":874,"y":620},{"x":868,"y":625},{"x":854,"y":631},{"x":850,"y":631},{"x":835,"y":639},{"x":816,"y":640},{"x":798,"y":645}],"connections":[90,87,86,88],"region":12},{"name":"Murdo","center":{"x":860.8333333333334,"y":570.1666666666666},"polygon":[{"x":874,"y":620},{"x":872,"y":614},{"x":835,"y":583},{"x":828,"y":578},{"x":847,"y":543},{"x":850,"y":533},{"x":856,"y":532},{"x":865,"y":534},{"x":868,"y":542},{"x":874,"y":552},{"x":877,"y":598},{"x":884,"y":613}],"connections":[77,76,86,91,89],"region":12},{"name":"Racketts","center":{"x":914,"y":560.3125},"polygon":[{"x":884,"y":613},{"x":877,"y":598},{"x":874,"y":552},{"x":868,"y":542},{"x":865,"y":534},{"x":895,"y":531},{"x":917,"y":527},{"x":930,"y":530},{"x":952,"y":532},{"x":963,"y":540},{"x":952,"y":549},{"x":948,"y":570},{"x":941,"y":578},{"x":933,"y":581},{"x":919,"y":588},{"x":906,"y":600}],"connections":[81,77,90],"region":12}]`;
		localStorage.bonusGroupsItems = `["Region 0","Bymar","West Gelyn","East Gelyn","North Avenia","South Avenia","NW Carthya","NE Carthya","Drylliad","South Carthya","North Mendenwal","Central Mendenwal","South Mendenwal"]`;
		localStorage.bonusValues = `[{"name":"Region 0","value":0,"colour":"#509"},{"name":"Bymar","value":2,"colour":"#4bf"},{"name":"West Gelyn","value":3,"colour":"#191"},{"name":"East Gelyn","value":3,"colour":"#4d2"},{"name":"North Avenia","value":4,"colour":"#e20"},{"name":"South Avenia","value":6,"colour":"#333"},{"name":"NW Carthya","value":3,"colour":"#129"},{"name":"NE Carthya","value":2,"colour":"#25b"},{"name":"Drylliad","value":5,"colour":"#fe0"},{"name":"South Carthya","value":3,"colour":"#37e"},{"name":"North Mendenwal","value":5,"colour":"#eee"},{"name":"Central Mendenwal","value":7,"colour":"#ff5"},{"name":"South Mendenwal","value":5,"colour":"#ff0"}]`;
	} // safe case
	if (localStorage.continents !== undefined) {
		continents = JSON.parse(localStorage.continents);
		bonusGroups.items = JSON.parse(localStorage.bonusGroupsItems);
		bonusValues = JSON.parse(localStorage.bonusValues);
	}
}
load();
var polygon = [];
var snapRange = 4;
var critPointer = null;
var criticalPoint = {x:null, y:null};
var renderCP = false;
var polygonSelected = null;
var dragging = {
	dragging: false,
	offX: null,
	offY: null
};
var polygonHover = null;
var connecting = {
	connecting: false,
	start: null,
	end: null
};
function createConnection() {
	if (connecting.start !== connecting.end && !continents[connecting.start].connections.includes(connecting.end)) {
		continents[connecting.start].connections.push(connecting.end);
		continents[connecting.end].connections.push(connecting.start);
	} else if (continents[connecting.start].connections.includes(connecting.end)) {
		//continents[connecting.start].connections.push(connecting.end);
	}
	connecting.start = null;
	connecting.end = null;
}

function renderConnections() {
	for (var i = 0; i < continents.length; i++) {
		for (var j = 0; j < continents[i].connections.length; j++) {
			var c = continents[i].connections[j];
			ctx.beginPath();
			ctx.lineTo(continents[i].center.x, continents[i].center.y);
			ctx.lineTo(continents[c].center.x, continents[c].center.y);
			ctx.stroke();
			ctx.beginPath();
			ctx.arc(continents[c].center.x, continents[c].center.y, 4, 0, 2*Math.PI);
			ctx.stroke();
		}
	}
}

function renderPolygon(pol, outline, fill) {
	if (pol.length === 1) {
		ctx.beginPath();
		ctx.arc(pol[0].x, pol[0].y, 5, 0, 2*Math.PI);
		ctx.stroke();
		return;
	}
	ctx.beginPath();
	for (var i = 0; i < pol.length; i++) {
		ctx.lineTo(pol[i].x, pol[i].y);
	}
	if (pol.length > 0) {
		ctx.lineTo(pol[0].x, pol[0].y);
	}
	if (fill !== undefined) {
		ctx.fillStyle = fill;
		ctx.fill();
	}
	
	ctx.strokeStyle = outline;
	ctx.lineWidth = 2;
	ctx.stroke();
}

function renderContinents(conts) {
	for (var i = conts.length-1; i >= 0; i--) {
		if (stage === 4) {
			renderPolygon(conts[i].polygon, "#000", "#29f");
		} else if (stage === 3) {
			renderPolygon(conts[i].polygon, ["#000", "#ff0"][Number(groupSelected === continents[i].region)], bonusValues[continents[i].region].colour);
		} else {
			renderPolygon(conts[i].polygon, "#000");
		}
	}
}

function render() {
	ctx.drawImage(reference.ref1, 0, 0);
	
	ctx.strokeStyle = "#000";
	renderContinents(continents);
	if (polygonHover !== null) {
		renderPolygon(continents[polygonHover].polygon, "#999");
	}
	if (polygonSelected !== null) {
		var pS = continents[polygonSelected];
		renderPolygon(pS.polygon, "#f33");
		ctx.strokeStyle = "#000";
		ctx.fillText(pS.name, pS.center.x-ctx.measureText(pS.name).width/2, pS.center.y+12);
	}
	renderPolygon(polygon, "#ff0");
	
	if (stage === 1) {
		ctx.strokeStyle = "#ddd";
		renderConnections();
	}
	
	if (stage === 3) {
		bonusGroups.hover = groupSelected;
		addRegion.render();
	}
	
	if (stage === 4) {
		for (var i = 0; i < continents.length; i++) {
			ctx.font = "16px Arial";
			ctx.fillStyle = "#fff";
			ctx.fillText(continents[i].name, continents[i].center.x-ctx.measureText(continents[i].name).width/2, continents[i].center.y);
		}
	}
	
	next.render();
	stages.render();
	bonusGroups.render();
	
	
	ctx.fillStyle = "#222";
	ctx.font = "24px Arial";
	ctx.fillText(stages.items[stage], next.x+next.width+10, next.y+next.height*3/4);
	
	if (renderCP) {
		ctx.strokeStyle = "#f33";
		ctx.beginPath();
		ctx.arc(criticalPoint.x, criticalPoint.y, 10, 0, 2*Math.PI);
		ctx.stroke();
	}
}

function update() {
	polygonHover = null;
	if (stage !== 0) {
		if (polygon.length !== 0) {
			addPolygon();
		}
	}
	if (stage !== 2) {
		polygonSelected = null;
	}
	if (stage === 3) {
		bonusGroups.height = bonusGroups.items.length*24+bonusGroups.textOffY*2
		bonusGroups.x = window.innerWidth-bonusGroups.width;
		bonusGroups.y = window.innerHeight-bonusGroups.height;
		bonusGroups.visible = true;
		addRegion.x = bonusGroups.x;
		addRegion.y = bonusGroups.y-addRegion.height;
	} else {
		bonusGroups.visible = false;
	}
	if (polygonSelected === null) {
		textinput.style.display = "none";
	} else {
		textinput.value = continents[polygonSelected].name;
		textinput.style.display = "block";
		//textinput.style.left = continents[polygonSelected].center.x-75+"px";
		//textinput.style.top = continents[polygonSelected].center.y-25+"px";
	}
	next.x = 0;
	next.y = canvas.height-next.height;
	stages.height = stages.items.length*24+stages.textOffY*2
	stages.x = next.x;
	stages.y = next.y-stages.height;
	if (!next.mouseOn() && !stages.mouseOn()) {
		stages.visible = false;
	}
	if (next.update()) {
		return;
	}
	if (stages.update()) {
		return;
	}
	if (bonusGroups.update()) {
		return;
	}
	if (stage === 3) {
		if(addRegion.update()) {
			return;
		}
	}
	
	switch (stage) {
		case 0: // Create Polygons
		if (keysDown.includes("Control")) {
			// default
			criticalPoint = {x: mouse.x, y: mouse.y};
			// find the critical point
			critFound:
			for (var i = 0; i < continents.length; i++) {
				for (var j = 0; j < continents[i].polygon.length; j++) {
					var p = continents[i].polygon[j];
					if (distance(mouse.x, mouse.y, p.x, p.y) < snapRange) {
						criticalPoint = {x: p.x, y: p.y};
						if (mouse.down) {
							critPointer = [i, j];
						}
						break critFound;
					}
				}
			}
			// loop through own polygon
			for (var i = 0; i < polygon.length; i++) {
				var p = polygon[i];
				if (distance(mouse.x, mouse.y, p.x, p.y) < snapRange) {
					criticalPoint = {x: p.x, y: p.y};
					break;
				}
			}
			renderCP = true;
		} else {
			renderCP = false;
		}
		if (mouse.down && !mouse.prev) {
			if (keysDown.includes("Control")) {
				if (polygon.length > 0 && criticalPoint.x === polygon[0].x && criticalPoint.y === polygon[0].y) {
					addPolygon();
				} else {
					polygon.push(criticalPoint);
				}
			} else {
				polygon.push({x: mouse.x, y: mouse.y});
			}
		}
		if (keysDown.includes(" ")) {
			addPolygon();
		}
		break;
		case 1: // Create Connections
		if (mouse.down && !mouse.prev) {
			for (var i = 0; i < continents.length; i++) {
				var p = continents[i].polygon;
				if (inPolygon(mouse.x, mouse.y, p)) {
					connecting.connecting = true;
					connecting.start = i;
					break;
				}
			}
		} else if (mouse.prev && !mouse.down) {
			for (var i = 0; i < continents.length; i++) {
				var p = continents[i].polygon;
				if (inPolygon(mouse.x, mouse.y, p)) {
					connecting.end = i;
					createConnection();
					break;
				}
			}
		}
		if (!mouse.down) {
			connecting.connecting = false;
		}
		break;
		case 2: // Edit Countries
		if (dragging.dragging) {
			if (!mouse.down) {
				dragging.dragging = false;
			} else {
				var p = continents[polygonSelected].polygon;
				for (var i = 0; i < p.length; i++) {
					p[i].x += mouse.x-dragging.offX;
					p[i].y += mouse.y-dragging.offY;
				}
				continents[polygonSelected].center.x += mouse.x-dragging.offX;
				continents[polygonSelected].center.y += mouse.y-dragging.offY;
				dragging.offX = mouse.x;
				dragging.offY = mouse.y;
			}
		} else {
			if (mouse.down && !mouse.prev) {
				polygonSelected = null;
			}
			for (var i = 0; i < continents.length; i++) {
				var p = continents[i].polygon;
				if (inPolygon(mouse.x, mouse.y, p)) {
					polygonHover = i;
					if (mouse.down && !mouse.prev) {
						polygonSelected = i;
						dragging.dragging = true;
						dragging.offX = mouse.x;
						dragging.offY = mouse.y;
					}
					break;
				}
			}
		}
		break;
		case 3: // Select Regions
		if (mouse.down) {
			for (var i = 0; i < continents.length; i++) {
				var p = continents[i].polygon;
				if (inPolygon(mouse.x, mouse.y, p)) {
					continents[i].region = groupSelected;
					break;
				}
			}
		}
		break;
	}
}

function inPolygon(x, y, pol) {
	var count = 0;
	for (var i = 0; i < pol.length; i++) {
		if (lineCrosses(x, y, pol[i].x, pol[i].y, pol[(i+1)%pol.length].x, pol[(i+1)%pol.length].y)) {
			count++;
		}
	}
	if (count%2 === 1) {
		return (true);
	}
	return (false);
}


function lineCrosses(x, y, a, b, c, d) {
	// sort points
	if (b === d) {
		return (false); // line is horizontal
	} else if (b < d) {
		var x1 = a;
		var y1 = b;
		var x2 = c;
		var y2 = d;
	} else {
		var x1 = c;
		var y1 = d;
		var x2 = a;
		var y2 = b;
	}
	// see if line crosses horizontally
	if (!(y1 <= y && y < y2)) {
		return (false);
	}
	// test if intersection within bounds
	if (x <= x1+(x2-x1)*(y-y1)/(y2-y1)) {
		return (true);
	}
	return (false);
}

function addPolygon() {
	if (polygon.length > 2) {
		var cX = 0;
		var cY = 0;
		for (var i = 0; i < polygon.length; i++) {
			cX += polygon[i].x;
			cY += polygon[i].y;
		}
		cX /= polygon.length;
		cY /= polygon.length;
		continents.push({
			name: "Unnamed",
			center: {x: cX, y: cY},
			polygon: polygon,
			connections: [],
			region: 0
		});
	}
	polygon = [];
}

var frame = 0;
function loop() {
	frame++;
	update();
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	render();
	mouse.prev = mouse.down;
}

setInterval(loop, 20);



var textinput = document.createElement("INPUT");
var inputX = 500;
var inputY = window.innerHeight-50;
textinput.value = "";
textinput.display = "none";
textinput.placeholder = "name";
textinput.style = `
top: ${inputY}px;
left: ${inputX}px;
`;
textinput.style.display = "none";
textinput.oninput = function() {
	continents[polygonSelected].name = this.value;
}
document.body.appendChild(textinput);





















